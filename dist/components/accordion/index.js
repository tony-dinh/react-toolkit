import _toConsumableArray from'babel-runtime/helpers/toConsumableArray';import _classCallCheck from'babel-runtime/helpers/classCallCheck';import _createClass from'babel-runtime/helpers/createClass';import _possibleConstructorReturn from'babel-runtime/helpers/possibleConstructorReturn';import _inherits from'babel-runtime/helpers/inherits';import React,{PropTypes}from'react';import Transition from'react-transition-group/Transition';import classNames from'classnames';import'./theme.scss';var noop=function(){},uuid=function(){var a=0;return function(){return a++}}(),AccordionItemContent=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.getContentHeight=c.getContentHeight.bind(c),c}return _inherits(b,a),_createClass(b,[{key:'getContentHeight',value:function getContentHeight(){return this._content.children.length?this._content.children[0].offsetHeight:0}},{key:'render',value:function render(){var a=this,b=this.props,c=b.children,d=b.style,e=classNames('td-accordion__item-content');return React.createElement('div',{className:e,style:d,ref:function ref(b){a._content=b}},c)}}]),b}(React.PureComponent),AccordionItem=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.animate=c.animate.bind(c),c.animateOpen=c.animateOpen.bind(c),c.animateClose=c.animateClose.bind(c),c.getContentHeight=c.getContentHeight.bind(c),c.onAnimationComplete=c.onAnimationComplete.bind(c),c.state={style:{maxHeight:'0',transition:'none'}},c}return _inherits(b,a),_createClass(b,[{key:'animateOpen',value:function animateOpen(){var a=this;this.animate(0,this.getContentHeight(),function completionHandler(){a.setState({style:{maxHeight:'initial',transition:'none'}}),a.onAnimationComplete()})}},{key:'animateClose',value:function animateClose(){var a=this;this.animate(this.getContentHeight(),0,function completionHandler(){a.onAnimationComplete()})}},{key:'animate',value:function animate(a,b,c){var d=this,e=this.props,f=e.duration,g=e.easing,h=function(){return new Promise(function(a){window.requestAnimationFrame(a)})};h().then(function setStartState(){return new Promise(function(b){d.setState({style:{maxHeight:a+'px',transition:'none'}},b)})}).then(h).then(function setEndState(){return new Promise(function(a){d.setState({style:{maxHeight:b+'px',transition:'max-height '+f+'ms '+g}},a)})}).then(function waitForAnimation(){setTimeout(c,f)})}},{key:'getContentHeight',value:function getContentHeight(){return this._content.getContentHeight()}},{key:'onAnimationComplete',value:function onAnimationComplete(){var a=this.props,b=a.open,c=a.onDidOpen,d=a.onDidClose,e=a.itemId;b?c(e):d(e)}},{key:'render',value:function render(){var a=this,b=this.props,c=b.className,d=b.children,e=b.duration,f=b.easing,g=b.headerClassName,h=b.headerContent,i=b.itemId,j=b.open,k=b.onClick,l=classNames('td-accordion__item',c,{"td-accordion__item--open":j}),m=classNames('td-accordion__header',g);return React.createElement('div',{id:i,className:l},React.createElement('button',{className:m,onClick:k,role:'tab',tabIndex:'0',type:'button',"aria-selected":j},h),React.createElement(Transition,{in:j,timeout:e,onEnter:this.animateOpen,onExit:this.animateClose,unmountOnExit:!0},React.createElement(AccordionItemContent,{style:this.state.style,ref:function ref(b){a._content=b}},d)))}}]),b}(React.PureComponent),Accordion=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.accordionId='accordion-'+uuid(),c.onItemClick=c.onItemClick.bind(c),c.updateItem=c.updateItem.bind(c),c.state={openItems:[].concat(_toConsumableArray(c.props.initialOpenItems))},c}return _inherits(b,a),_createClass(b,[{key:'updateItem',value:function updateItem(a,b){if(!(0>a||a>=React.Children.count(this.props.children))){var c=this.props.multiSelect,d=[].concat(_toConsumableArray(this.state.openItems));b?c?d.push(a):d=[a]:c?d.splice(d.indexOf(a),1):d=[],this.setState({openItems:d})}}},{key:'onItemClick',value:function onItemClick(a){var b=this.state.openItems,c=-1===b.indexOf(a);this.updateItem(a,c)}},{key:'render',value:function render(){var a=this,b=this.props,c=b.className,d=b.children,e=b.duration,f=b.easing,g=b.multiSelect,h=b.onItemOpen,i=b.onItemDidOpen,j=b.onItemClose,k=b.onItemDidClose,l=classNames('td-accordion',c);return React.createElement('div',{className:l,id:this.accordionId,"aria-multiselectable":g,role:'tablist'},React.Children.map(d,function(b,c){if(!b)return null;var d=a.accordionId+'__item-'+c,g={accordionId:a.accordionId,id:d,duration:e,easing:f,key:d,open:-1<a.state.openItems.indexOf(c),onClick:a.onItemClick.bind(a,c)};return g.onOpen=g.onOpen||h,g.onDidOpen=g.onDidOpen||i,g.onClose=g.onClose||j,g.onDidClose=g.onDidClose||k,React.cloneElement(b,g)}))}}]),b}(React.Component);Accordion.propTypes={children:PropTypes.node,className:PropTypes.string,duration:PropTypes.number,easing:PropTypes.string,initialOpenItems:PropTypes.arrayOf(PropTypes.number),multiSelect:PropTypes.bool,onItemOpen:PropTypes.func,onItemDidOpen:PropTypes.func,onItemClose:PropTypes.func,onItemDidClose:PropTypes.func},Accordion.defaultProps={initialOpenItems:[],duration:250,easing:'ease',multiSelect:!0,onItemOpen:noop,onItemDidOpen:noop,onItemClose:noop,onItemDidClose:noop};export{Accordion,AccordionItem};export default Accordion;